<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Strict//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Language" content="en-us"><title>eLua platform interface - UART</title>

<link rel="stylesheet" type="text/css" href="../style.css"></head>
<body style="background-color: rgb(255, 255, 255);">
<h3>Overview</h3>
<p>This part of the platform interface groups functions related to the UART interface(s) of the MCU.</p>
<h3>Data structures, constants and types</h3>
<a name="parval"><p><pre><code>// Parity
enum
{
  PLATFORM_UART_PARITY_EVEN,
  PLATFORM_UART_PARITY_ODD,
  PLATFORM_UART_PARITY_NONE
};</code></pre></p></a>
<p>Constants used to specify the UART parity mode.</p>

<a name="stopval"><p><pre><code>// Stop bits
enum
{
  PLATFORM_UART_STOPBITS_1,
  PLATFORM_UART_STOPBITS_1_5,
  PLATFORM_UART_STOPBITS_2
};</code></pre></p></a>
<p>Constants used to specify the number of UART stop bits.</p>

<a name="toinf"><p><pre><code>// "Infinite timeout" constant for recv
#define PLATFORM_UART_INFINITE_TIMEOUT        (-1)</code></pre></p></a>
<p>This constant is used as a special timeout value (infinite timeout) in the UART functions that expect a timeout as argument.</p>

<h3>Functions</h3>
<p><pre><code>int platform_uart_exists( unsigned id );</code></pre></p>
<p>Returns 1 if the platform has the hardware UART specified as argument, 0 otherwise. Implemented in <i>src/common.c</i>, it uses the <b>NUM_UART</b> macro that must be defined in the
platform's <b>platform_conf.h</b> file (see <a href="arch_overview.html#platforms">here</a> for details). For example:</p>
<p><code>#define NUM_UART   2      <b>// The platform has 2 UART interfaces</b></code></p>

<p><pre><code>u32 platform_uart_setup( unsigned id, u32 baud, int databits, int parity, int stopbits );</code></pre></p>
<p>This function is used to initialize the parameters of the UART interface.<br>
Arguments:
<ul>
  <li><b>id</b>: the ID of the UART interface.</li>
  <li><b>baud</b>: baud rate.</li>
  <li><b>databits</b>: number of data bits (maximum 8).</li>
  <li><b>parity</b>: parity type (can be either <b>PLATFORM_UART_PARITY_EVEN</b>, <b>PLATFORM_UART_PARITY_ODD</b> or <b>PLATFORM_UART_PARITY_NONE</b>, see <a href="#parval">here</a>).</li>
  <li><b>stopbits</b>: number of stop bits (can be either <b>PLATFORM_UART_STOPBITS_1</b>, <b>PLATFORM_UART_STOPBITS_1_5</b> or <b>PLATFORM_UART_STOPBITS_2</b>, see 
         <a href="#stopval">here</a>).</li>
</ul></p>
<p>This function returns the actual baud rate. Depending on the hardware, this may have a different value than the <b>baud</b> argument.</p>

<p><pre><code>void platform_uart_send( unsigned id, u8 data );</code></pre></p>
<p>Send the given <b>data</b> to the UART interface with the specified <b>id</b>. </p>

<p><pre><code>int platform_uart_recv( unsigned id, unsigned timer_id, s32 timeout );</code></pre></p>
<p>Receive a byte from the UART interface with the specified <b>id</b>. <b>timeout</b> specifies a timeout for the receive operation as follows:
<ul>
  <li><b>timeout &gt; 0</b>: the timer with the specified <b>timer_id</b> (see <a href="arch_platform_timers.html">here</a>) will be used to timeout the receive operation after 
      <b>timeout</b> microseconds. If data from the UART is available before the timeout expires, the function returns it, otherwise it returns -1.</li>
  <li><b>timeout = 0</b>: the function returns immediately with data from the UART if available or -1 if UART data is not available. In this mode, <b>timer_id</b> is ignored.</li>
  <li><b>timeout = <a href="#toinf">PLATFORM_UART_INFINITE_TIMEOUT</a></b>: the function waits for UART data to be available and returns it. In this mode the function doesn't 
      time out, so -1 is never returned. In this mode, <b>timer_id</b> is ignored.</li>
</ul></p>
<p>This function is "split" in two parts: a platform-independent part that is implemented in <i>src/common.c</i>, and a platform-dependent part that must be implemented by each
platform in a function named <b>platform_s_uart_recv</b> (see below).</p>
<p><pre><code>int platform_s_uart_recv( unsigned id, s32 timeout );</code></pre></p>
<p>This is the platform-dependent part of the UART receive function <b>platform_uart_recv</b> (see above), and is in fact a "subset" of the full function (thus being easier to implement). 
It receives a byte from the UART interface with the specified <b>id</b>. <b>timeout</b>
specifies a timeout for the receive operation that can be either 0 or PLATFORM_UART_INFINITE_TIMEOUT, see the <b>platform_uart_recv</b> function (above) for a full description of the
<b>timeout</b> argument. <b>NOTE</b>: this function doesn't have to deal with the <b>timeout &gt; 0</b> case, this is handled by the generic implementation in <i>src/common.c</i>.</p>
</body></html>

